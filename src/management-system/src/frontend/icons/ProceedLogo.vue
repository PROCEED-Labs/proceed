<template>
  <svg
    xmlns:v="http://schemas.microsoft.com/visio/2003/SVGExtensions/"
    xmlns:dc="http://purl.org/dc/elements/1.1/"
    xmlns:cc="http://creativecommons.org/ns#"
    xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#"
    xmlns:svg="http://www.w3.org/2000/svg"
    xmlns="http://www.w3.org/2000/svg"
    xmlns:sodipodi="http://sodipodi.sourceforge.net/DTD/sodipodi-0.dtd"
    xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape"
    viewBox="0 0 121.9017 18.044838"
    version="1.1"
    id="svg1427"
    inkscape:version="0.92.3 (2405546, 2018-03-11)"
    sodipodi:docname="Logo - Name with included Symbol - text to path.svg"
  >
    <defs id="defs1421">
      <linearGradient id="GreenGradient1" x1="0" x2="1" y1="0" y2="0">
        <stop class="proceed-logo-stop1" offset="0%" stop-color="#595959" />
        <stop class="proceed-logo-stop2" offset="0%" stop-color="#595959" />
        <stop class="proceed-logo-stop3" offset="0%" stop-color="green" />
        <stop class="proceed-logo-stop4" offset="0%" stop-color="green" />
        <stop class="proceed-logo-stop5" offset="0%" stop-color="#595959" />
        <stop class="proceed-logo-stop6" offset="100%" stop-color="#595959" />
      </linearGradient>
      <linearGradient id="GreenGradient2" x1="0" x2="1" y1="0" y2="0">
        <stop class="proceed-logo-stop1" offset="0%" stop-color="#595959" />
        <stop class="proceed-logo-stop2" offset="0%" stop-color="#595959" />
        <stop class="proceed-logo-stop3" offset="0%" stop-color="green" />
        <stop class="proceed-logo-stop4" offset="0%" stop-color="green" />
        <stop class="proceed-logo-stop5" offset="0%" stop-color="#595959" />
        <stop class="proceed-logo-stop6" offset="100%" stop-color="#595959" />
      </linearGradient>
    </defs>
    <sodipodi:namedview
      id="base"
      pagecolor="#ffffff"
      bordercolor="#666666"
      borderopacity="1.0"
      inkscape:pageopacity="0.0"
      inkscape:pageshadow="2"
      inkscape:zoom="0.98994949"
      inkscape:cx="78.348132"
      inkscape:cy="-14.345218"
      inkscape:document-units="mm"
      inkscape:current-layer="layer1"
      showgrid="false"
      inkscape:window-width="1920"
      inkscape:window-height="1001"
      inkscape:window-x="0"
      inkscape:window-y="1200"
      inkscape:window-maximized="1"
      fit-margin-top="0"
      fit-margin-left="0"
      fit-margin-right="0"
      fit-margin-bottom="0"
    />
    <metadata id="metadata1424">
      <rdf:RDF>
        <cc:Work rdf:about="">
          <dc:format>image/svg+xml</dc:format>
          <dc:type rdf:resource="http://purl.org/dc/dcmitype/StillImage" />
          <dc:title></dc:title>
        </cc:Work>
      </rdf:RDF>
    </metadata>
    <g
      inkscape:label="Layer 1"
      inkscape:groupmode="layer"
      id="layer1"
      :class="classes"
      transform="translate(-44.504506,-28.292016)"
    >
      <g aria-label="proc" transform="scale(0.9141768,1.0938803)" class="test" id="text1246">
        <path
          d="M 62.754603,47.019176 H 52.00563 v 9.053552 H 48.682604 V 43.69615 H 62.17816 q 1.72933,0 1.72933,-0.881619 v -3.797744 q 0,-1.017253 -1.72933,-1.017253 H 48.682604 v -3.323027 h 13.902457 q 4.645455,0 4.645455,3.594294 V 43.4927 q 0,3.492568 -4.475913,3.526476 z"
          class="font-class common-class"
          id="path860"
          inkscape:connector-curvature="0"
        />
        <path
          d="M 73.993129,47.019176 V 38.94897 q 0,-1.017253 1.72933,-1.017253 H 88.200762 V 34.60869 H 75.315558 q -4.645455,0 -4.645455,3.594294 v 8.816192 z"
          class="font-class common-class"
          id="path862"
          inkscape:connector-curvature="0"
        />
        <path
          d="m 96.682638,43.69615 h 8.477112 q 1.72933,0 1.72933,-0.983344 V 38.94897 q 0,-1.017253 -1.72933,-1.017253 h -8.477112 q -1.695421,0 -1.695421,1.017253 v 3.763836 q 0,0.983344 1.695421,0.983344 z m 8.884012,3.323026 h -9.257005 q -4.645455,0 -4.645455,-3.560385 v -5.255807 q 0,-3.594294 4.645455,-3.594294 h 9.257005 q 4.64545,0 4.64545,3.594294 v 5.255807 q 0,3.560385 -4.64545,3.560385 z"
          class="font-class common-class"
          id="path864"
          inkscape:connector-curvature="0"
        />
        <path
          d="m 118.29714,47.019176 h 12.88521 V 43.69615 h -12.4783 q -1.72933,0 -1.72933,-0.983344 V 38.94897 q 0,-1.017253 1.72933,-1.017253 h 12.4783 V 34.60869 h -12.88521 q -4.64545,0 -4.64545,3.594294 v 5.255807 q 0,3.560385 4.64545,3.560385 z"
          class="font-class common-class"
          id="path866"
          inkscape:connector-curvature="0"
        />
      </g>
      <g
        class="font-size common-class"
        id="shape4-7-2"
        v:mID="4"
        v:groupContext="shape"
        transform="matrix(0.51663939,0,0,0.61819737,122.87891,-40.99114)"
      >
        <title id="title1256" />
        <path
          class="stroke-class"
          inkscape:connector-curvature="0"
          d="m 0,144.3 h 12.95 l 5.11,-5.73 -5.11,-5.73 H 0 l 5.12,5.73 z"
          id="path1258"
        />
      </g>
      <g
        class="font-size common-class"
        id="shape3-5-8"
        v:mID="3"
        v:groupContext="shape"
        transform="matrix(0.51663939,0,0,0.61819737,129.39647,-37.786489)"
      >
        <title id="title1251" />
        <path
          class="stroke-class"
          inkscape:connector-curvature="0"
          d="m 0,144.3 h 24.66 l 9.75,-10.91 -9.75,-10.92 H 0 l 9.75,10.92 z"
          id="path1253"
        />
      </g>
      <g
        aria-label="d"
        transform="scale(0.9141768,1.0938803)"
        class="font-class common-class"
        style="stroke: none; stroke-opacity: 1"
        id="text1268"
      >
        <path
          d="m 182.02847,47.260128 v -3.323026 h -13.49555 q -1.72933,0 -1.72933,-0.983345 v -3.763836 q 0,-1.017253 1.72933,-1.017253 h 13.49555 V 25.863907 h -3.35693 v 8.985735 h -10.54552 q -4.64546,0 -4.64546,3.594294 v 5.255807 q 0,3.560385 4.64546,3.560385 z"
          class="font-class common-class"
          style="stroke: none; stroke-opacity: 1"
          id="path869"
          inkscape:connector-curvature="0"
        />
      </g>
    </g>
  </svg>
</template>
<script>
export default {
  name: 'ProceedLogo',
  props: ['enginePublishing', 'loading', 'working'],
  data() {
    return {
      animationFunction: null,
    };
  },
  computed: {
    /**
     * computes all classes used for animations set in props
     */
    classes() {
      const classes = [];

      if (this.enginePublishing) classes.push('engine-publishing');

      if (this.working) classes.push('working');

      return classes;
    },
  },
  methods: {
    /**
     * animates the logo while loading is set to true
     */
    animateLoading() {
      const gradients = document.getElementsByTagName('linearGradient');

      const gradientStops = [];
      gradientStops.push(Array.from(gradients[0].children));
      gradientStops.push(Array.from(gradients[1].children));

      const chars = Array.from(document.getElementsByTagName('path'));

      const charBoundaries = [];

      chars.forEach((char) => {
        const boundary = char.getBoundingClientRect();
        charBoundaries.push({ start: boundary.x, width: boundary.width });
      });
      const lastCharBoundary = charBoundaries[chars.length - 1];

      let currentPos = charBoundaries[0].start;
      const maxPos = lastCharBoundary.start + lastCharBoundary.width;
      let currentChar = 0;
      let lastChar = 0;

      const blockSize = 60;

      chars[0].setAttribute('fill', 'url(#GreenGradient1)');

      const numChars = chars.length;

      this.animationFunction = setInterval(() => {
        if (!this.loading) {
          chars.forEach((char) => {
            char.removeAttribute('fill');
          });
          clearInterval(this.animationFunction);
        }

        let nextCharStart = charBoundaries[(currentChar + 1) % numChars].start;

        if (currentChar === numChars - 1) {
          nextCharStart = maxPos;
        }

        if (currentPos >= nextCharStart) {
          if (currentPos >= maxPos) {
            currentPos = charBoundaries[0].start;
          }
          lastChar = currentChar;
          currentChar = (currentChar + 1) % numChars;
          chars[currentChar].setAttribute('fill', 'url(#GreenGradient1)');
          chars[(currentChar - 1 + numChars) % numChars].setAttribute(
            'fill',
            'url(#GreenGradient2',
          );
          chars[(currentChar - 2 + numChars) % numChars].removeAttribute('fill');
        }

        if (!charBoundaries[currentChar].width) {
          const { x, width } = chars[currentChar].getBoundingClientRect();
          charBoundaries[currentChar].start = x;
          charBoundaries[currentChar].width = width;
          return;
        }

        const posInCurChar = currentPos - charBoundaries[currentChar].start;
        const blockEndInChar = posInCurChar - blockSize;
        const fillPercent = (100 * posInCurChar) / charBoundaries[currentChar].width;
        const blockEndPercent = (100 * blockEndInChar) / charBoundaries[currentChar].width;

        if (!charBoundaries[lastChar].width) {
          const { x, width } = chars[lastChar].getBoundingClientRect();
          charBoundaries[lastChar].start = x;
          charBoundaries[lastChar].width = width;
          return;
        }

        const posInLastChar = currentPos - charBoundaries[lastChar].start;
        const blockEndInLast = posInLastChar - blockSize;
        const lastFillPercent = (100 * posInLastChar) / charBoundaries[lastChar].width;
        const lastBlockEndPercent = (100 * blockEndInLast) / charBoundaries[lastChar].width;

        gradientStops[0][3].setAttribute('offset', `${fillPercent}%`);
        gradientStops[0][4].setAttribute('offset', `${fillPercent + 1}%`);
        gradientStops[0][1].setAttribute('offset', `${blockEndPercent - 1}%`);
        gradientStops[0][2].setAttribute('offset', `${blockEndPercent}%`);

        gradientStops[1][3].setAttribute('offset', `${lastFillPercent}%`);
        gradientStops[1][4].setAttribute('offset', `${lastFillPercent + 1}%`);
        gradientStops[1][1].setAttribute('offset', `${lastBlockEndPercent - 1}%`);
        gradientStops[1][2].setAttribute('offset', `${lastBlockEndPercent}%`);

        currentPos += 1;
      }, 10);
    },
  },
  mounted() {
    if (this.loading) this.animateLoading();
  },
  beforeDestroy() {
    const chars = Array.from(document.getElementsByTagName('path'));
    chars.forEach((char) => {
      char.removeAttribute('fill');
    });
    clearInterval(this.animationFunction);
  },
  watch: {
    loading() {
      if (this.loading) this.animateLoading();
    },
  },
};
</script>
<style>
#proceed-logo {
  overflow: visible;
}

#svg1427 {
  overflow: visible;
}

g {
  fill: #595959;
}

.engine-publishing path {
  fill: green;
}

.loading path {
  fill: #595959;
}

.working path {
  fill: red;
}

.font-class {
  font-size: 33.90843201px;
  font-family: 'Radio Space';
  stroke-width: 0.56514168;
}

.font-size {
  font-size: medium;
}

.common-class {
  color-interpolation-filters: sRGB;
  fill-rule: evenodd;
  stroke-linecap: square;
  stroke-miterlimit: 3;
}

.stroke-class {
  stroke: none;
  stroke-width: 0.23999999;
  stroke-linecap: round;
  stroke-linejoin: round;
}
</style>
